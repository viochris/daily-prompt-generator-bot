name: Daily Prompt Generator Bot

# TRIGGER: When should this workflow run?
on:
  schedule:
    # Cron Format: 'Minute Hour * * *' (UTC Time)
    # We want it to run BEFORE the image generator runs.
    # Example: 06:00 AM WIB (Western Indonesia Time) = 23:00 UTC previous day
    - cron: '0 23 * * *'
  
  # Allows you to run this workflow manually from the Actions tab (for testing)
  workflow_dispatch:

# JOBS: What tasks to execute?
jobs:
  run-prompt-bot:
    runs-on: ubuntu-latest # Uses a standard Ubuntu runner provided by GitHub
    
    steps:
      # 1. Checkout repository code
      - name: Checkout Code
        uses: actions/checkout@v3
        
      # 2. Set up Python environment
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11' # Ensure this matches your local Python version
          
      # 3. Install required libraries
      - name: Install Dependencies
        run: |
          pip install --upgrade pip
          # Installing specific libraries used in auto-prompt-generate.py
          pip install prefect gspread python-dotenv google-genai
        
      # 4. CREATE JSON KEY FILE (IMPORTANT)
      # Since we cannot upload 'chatbot_key.json' to GitHub (Security Risk),
      # we store the CONTENT of the JSON file in a GitHub Secret named 'GCP_SA_KEY'.
      # This step creates the physical file on the server so gspread can find it.
      - name: Create Google Credentials File
        run: echo '${{ secrets.GCP_SA_KEY }}' > chatbot_key.json

      # 5. RUN THE SCRIPT
      # We inject the secrets (API Keys) securely into the environment here
      - name: Run Prompt Generator Script
        env:
          # These must match os.getenv("...") in your Python script
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        
        # Make sure your python file is named correctly in the repo
        run: python auto-prompt-generate.py
